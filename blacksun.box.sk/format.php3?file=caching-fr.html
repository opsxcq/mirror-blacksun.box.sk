<html>
<head>
<title>Black Sun Research Facility Tutorials</title>
<STYLE type=text/css>A:active {



        TEXT-DECORATION: none



}



A:hover {



        COLOR: #ffffff; TEXT-DECORATION: none



}



A:link {



        TEXT-DECORATION: none



}



A:visited {



        TEXT-DECORATION: none



}



.small {



        COLOR: #ffffff; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 8pt; FONT-WEIGHT: bold



}



.small_uppercase {



        COLOR: #999999; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 8pt



}



TD {



        COLOR: #aeaeae; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 8pt



}



.7_ver_b_white {



        COLOR: #ffffff; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 7pt; FONT-WEIGHT: bold



}



BODY {



        FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 8pt; SCROLLBAR-FACE-COLOR: #ffa534; SCROLLBAR-HIGHLIGHT-COLOR: #ffd756; SCROLLBAR-SHADOW-COLOR: #ff8312; SCROLLBAR-3DLIGHT-COLOR: #000000; SCROLLBAR-ARROW-COLOR: #ffffff; SCROLLBAR-TRACK-COLOR: #333333; SCROLLBAR-DARKSHADOW-COLOR: #000000



}



.white {



        COLOR: #ffffff; FONT-FAMILY: Verdana, Arial, Helvetica, sans-serif; FONT-SIZE: 7pt; FONT-WEIGHT: bold



}



</STYLE>
</head>
<body alink="#ffcc00" bgcolor="#000000" leftmargin="0" link="#ff9900" text="#a7a7a7" topmargin="0" vlink="#ff9900" marginwidth="0" marginheight="0">
            <TABLE border=0 cellPadding=0 cellSpacing=0 width=782>



              <TBODY>



              <TR bgColor=#ffcc00 vAlign=top>



                <TD height=1></TD></TR>



              <TR bgColor=#ff9900 vAlign=top>



                <TD>



                  <CENTER>



                  <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">



                    <TBODY>



                    <TR>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><A class=white



                        href="http://blacksun.box.sk/tutorials.html">Tutorials</A></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/byteme.html">Byte



                        Me</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/acro.html">C.A.I.R.A</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://dvd.box.sk/wb/index.php3?did=blacksun&amp;closed=0">Message



                        Board</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/shelllist.html">Shells      </A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/team.html">The



                        Team</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/chat/">Online



                        Chat</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/links.html">Links</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/translations.htm">Translations</A></FONT></DIV></TD>



                      <TD onmouseout="this.style.backgroundColor='#ff9900';"



                      onmouseover="this.style.backgroundColor='#FEAC01';">



                        <DIV align=center><FONT color=#000000><A class=white



                        href="http://blacksun.box.sk/books.html">Books</A>



                        </FONT></DIV></TD>

 
</TR></TBODY></TABLE></CENTER></TD></TR>



              <TR bgColor=#ff6600 vAlign=top>



                <TD height=1></TD></TR>



              <TR bgColor=#000000 vAlign=top>



                <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE><br><br>
<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content=
"text/html; charset=iso-8859-1">
<TITLE>Mettre en place un serveur de cache DNS</TITLE>
</HEAD>
<BODY bgcolor="#BEBCD3">
<CENTER>
<H1>Acc&eacute;l&eacute;rez votre connection internet sous Linux
et Windows</H1>
</CENTER>

<CENTER>
<H1>(Mettre en place un cache DNS)</H1>
</CENTER>

Derni&eacute;re mise &agrave; jour 3-12-1999 by GoMoRRaH. <BR>
Traduction par Vortex , vortex@franceimel.com <BR>
GoMoRRaH est membre du Black Sun Research Facility (BSRF). <BR>
D'autres didactiels sur des sujets tel que le hacking, cracking,
phreaking, Unix, Windows et Windows NT, r&eacute;seaux,
mat&eacute;riel et overclocking, programmation, HTML , etc.. sur
http://blacksun.box.sk 

<P>www.xxxxx.com est utilis&eacute; comme exemple de site , bien
qu'&eacute;tant inexistant .</P>

<H2>1 Un peu de th&eacute;orie</H2>

<H3>1.1 Introduction</H3>

Internet &eacute;volue de jour en jour, les Pc deviennent plus
rapides, les connexions plus fiables, etc... Mais la plus
importante des &eacute;volutions est celle de la capacit&eacute;
des lignes. Les lignes t&eacute;l&eacute;phoniques classiques
sont supplant&eacute;s par l'ASDL ou le cable ( en th&eacute;orie
). Toutefois, il reste des gens ( malchanceux, comme moi ) qui
doivent se contenter d'une simple ligne
t&eacute;l&eacute;phonique horriblement leeeeeeennnnnnnte. Et ces
personnes cherchent donc &agrave; acc&eacute;l&eacute;rer leur
connexion. Bien sur, il existe des programmes, comme les
gestionnaires de t&eacute;l&eacute;chargements, qui profitent des
temps morts pour r&eacute;cup&eacute;rer les pages qui suivent
celle que vous visitez. Et il y a beaucoup de facon d'ajuster
l'&eacute;lectronique de votre modem. 

<P>Toutefois, comme vous pouvez le constater, il s'agit surtout
de logiciels Windows, ou de bidouillages risqu&eacute;s de modem.
La m&eacute;thode qui suit est pour Linux, et est suffisament
simple pour que m&ecirc;me un utilisateur de Windows soit capable
de l'appliquer :P<BR>
La m&eacute;thode pour Windows est &eacute;galement
expliqu&eacute;</P>

<H3>1.2 A qui est destin&eacute; ce document, mat&eacute;riel
requis</H3>

Toute personne qui d&eacute;sire acc&eacute;l&eacute;rer sa
connexion de quelques secondes et qui veut le faire en 5 minutes
( si ce n'est pas moins ). 

<P>Avant de poser des questions, lisez au moins les didacticiels
de base sur les r&eacute;seaux sur blacksun.box.sk.<BR>
De plus, n'&eacute;crivez pas directement au membres du BSRF. Il
y a un forum sur blacksun.box.sk - utilisez le.</P>

<P>La m&eacute;thode pour Windows se trouve &agrave; la fin du
document</P>

<P>Mat&eacute;riel requis</P>

<UL>
<LI>Un ordinateur</LI>

<LI>Une connexion &agrave; Internet</LI>

<LI>Linux install&eacute; , en &eacute;tat de marche</LI>

<LI>Named install&eacute; (1)</LI>

<LI>5 minutes</LI>

<LI>Quelque instants &agrave; me consacrer</LI>
</UL>

<I>(1) Named est un serveur DNS stantard , la plupart des
distributions Linux sont fournis avec. Son installation devrait
se passer sans probl&eacute;mes.</I> 

<H3>1.3 Que fait un serveur DNS ?</H3>

Que fait un serveur DNS ? Eh bien, vous &ecirc;tes
connect&eacute; avec votre FAI et vous d&eacute;sirez aller sur
www.xxxxx.com. Vous lancez votre navigateur et entrez
http://www.xxxxx.com dans la barre d'adresses, appuyez sur
Entr&eacute;e et attendez jusqu &agrave; l'apparition de xxxxx .
<BR>
Facile, n'est ce pas ? Jetons un coup d'oeil en coulisse pour
observer ceci plus en d&eacute;tail. 

<OL>
<LI>Votre ordinateur r&eacute;cup&eacute;re la
r&eacute;qu&ecirc;te de connexion &agrave; www.xxxxx.com, mais
que represente www.xxxxx.com ? C 'est l'alias d'un ordinateur
(qui pos&eacute;de une adresse IP), sur lequel tourne un Daemon
sur le port 80.</LI>

<LI>Votre machine regarde si le site n'est pas sur votre propre
ordinateur, ou sur votre r&eacute;seau local. Donc, il consulte
le fichier /etc/hosts (qui conserve les informations sur votre
intranet) ou va consulter un serveur DNS local (toutefois , comme
vous lisez ce document, je suppose que vous ne poss&eacute;dez
pas de serveur DNS install&eacute; (pas encore), donc cela ne se
produira pas). Au passage, j'en profite pour caser la
signification de DNS : Domain Name server (serveur de Noms de
Domaines).<I>(NdT : je sais que serveur DNS est redondant , mais
je trouve &ccedil;a plus joli)</I></LI>

<LI>En fait, votre ordinateur ne regarde pas votre r&eacute;seau
local, mais regarde s'il peut trouver l'adresse IP sur votre
intranet local (Il est 'possible' que vous sachiez que Internet
est bas&eacute;e sur le protocole TCP/IP :P )</LI>

<LI>Donc, il regarde le fichier /etc/resolv.conf, qui devrait
ressembler &agrave; ceci :</LI>

<BR>
<BR>
<I>nameserver 123.123.123.123</I><BR>
<BR>


<LI>C'est le serveur DNS de votre FAI. Si rien n'est
trouv&eacute; sur votre Intranet, votre ordinateur ira demander
&agrave; ce serveur DNS. (si il ne peut pas le trouver , vous
obtiendrez une splendide erreur)</LI>

<LI>Si vous arrivez &agrave; le questionner , il vous donnera une
adresse IP. Si www.xxxxx.com est inconnu pour le serveur ,
&agrave; son tour , il demandera &agrave; un autre serveur , et
&agrave; la fin, vous aurez votre adresse IP.</LI>

<LI>Une fois cette adresse IP (par exemple 123.123.123.111) en
votre possesion, il va y avoir une tentative de connexion
&agrave; 123.123.123.111:80 (connexion standard, comme vous
pouvez le constater avec la commande <I>route</I> depuis le
compte root).</LI>
</OL>

Une fois la connexion &eacute;tabli, les fichiers sont
transf&eacute;res suivant le protocole HTTP. Donc, le serveur DNS
traduit www.xxxxx.com en adresse IP en consultant sa base de
donn&eacute;e ou celle d'un autre. 

<H3>1.4 H&eacute; , cela semble cool !!! Et maintenant ? :p</H3>

Cela prends 2 secondes si vous avez une connexion rapide et un
FAI avec un serveur DNS totalement d&eacute;sert , avec l'IP dans
sa base de donn&eacute;es. Vous remarquez que c'est une utopie de
croire que cela ne prends que 2 secondes. En fait cela prendra un
peu plus de temps. Dans ce didacticiel , nous allons apprendre
&agrave; r&eacute;aliser un serveur de cache DNS. 

<H3>1.5 Qu'est ce qu'un serveur de cache DNS ?</H3>

En gros, c'est un serveur DNS un peu sp&eacute;ciale. Il n'est
pas destin&eacute;e &agrave; &ecirc;tre le serveur DNS de votre
intranet. La seule chose qu'il fait est de stocker dans un cache
tous les noms et adresses IP qui sont demand&eacute;es par le
r&eacute;seau local. La premi&eacute;re fois que vous cherchez
une adresse IP , un autre base de donn&eacute;es doit &ecirc;tre
consult&eacute;s ( celle de votre FAI ). Mais, les fois
suivantes, cela ne se produira plus. En effet, tout est sur votre
disque dur, donc cela n'utilise pas votre bande passante, et le
site arrivera plus t&ocirc;t, de quelques secondes, ce qui rendra
le surf plus FUN. Vous vous dites surement "Bordel , mais 2
secondes , c'est rien !" Certes, mais combien de fois utilisez
vous un moteur de recherche ? Allez vous souvent sur votre site
favori, regardez vous r&eacute;gulierement votre courrier ?
(toutes les 10 minutes est le r&eacute;glage par d&eacute;faut de
Netscape) 

<P>La th&eacute;orie s'arr&eacute;te ici, vous devriez pouvoir
comprendre ce que fait un serveur de cache DNS et comment il peut
acc&eacute;l&eacute;rer votre connexion de quelques secondes, il
est grand temps de mettre la th&eacute;orie en pratique en
mettant votre clavier &agrave; contribution.</P>

<H2>2 Ras le bol de la th&eacute;orie , filez moi du concret</H2>

<H3>2.1 named.conf</H3>

Tout d'abord, nous allons &eacute;diter le fichier de
configuration du serveur DNS. Le fichier est appel&eacute;
/etc/named.conf et devrait ressembler &agrave; ceci : 

<PRE>
<I>options {
        directory "/var/named";
        /* Some shit */
};
....</I>
</PRE>

La premi&eacute;re partie est celle que nous allons changer. Pour
cela, il vous faut connaitre le serveur DNS de votre FAI (PAS le
nom, mais l'adresse IP!!!), pour pouvoir l'ajouter au fichier: 

<PRE>
<I>options {
        directory "/var/named";
        forwarders {
                123.123.123.123;
                123.123.123.124;
                };
};
....</I>
</PRE>

Vous avez simplement dit que qu'une requ&eacute;te inconnue doit
&ecirc;tre transmise &agrave; l'adresse ci dessus. Si la
premi&eacute;re ne fonctionne pas, la seconde va &ecirc;tre
tenter. 

<H3>2.2 Changer le serveur DNS</H3>

En fait, maintenant, vous avez presque un serveur DNS qui
fonctionne. Mais il y a encore un hic, votre b&eacute;cane ne
reconnait pas votre nouveau serveur, et donc, ne l'utilise pas
encore. Vous devez &eacute;diter <I>/etc/resolv.conf</I>, de tel
facon qu'il ressemble &agrave; &ccedil;a : 

<PRE>
<I># nameserver 321.321.321.321
nameserver 127.0.0.1</I>
</PRE>

La premi&eacute;re ligne est votre serveur DNS original, il
suffit de la mettre en commentaire (ajoutez # au d&eacute;but de
la ligne), au cas o&ugrave;, et d'ajouter la ligne <I>nameserver
127.0.0.1</I>, ce qui signifie que les requ&ecirc;tes doivent
&ecirc;tre adress&eacute;s &agrave; votre serveur local. 

<H3>2.3 Le moment de v&eacute;rit&eacute;</H3>

Vous avez juste &agrave; (re)d&eacute;marrer votre serveur DNS
avec la commande <I>killall -HUP named</I>. Puis vous devrez
regarder les messages ( /var/log/messages ) et avoir la chance de
voir qu'ils ressemblent &agrave; ceux la : 

<PRE>
Nov 20 13:29:34 SaTaN named[692]: starting.  named 8.2.1 Fri Sep 24 14:52:24 EDT 1999 ^Iroot@porky.devel.redhat.com:/usr/src/bs/BUILD/bind-8.2.1/src/bin/named
Nov 20 13:29:34 SaTaN named[692]: hint zone "" (IN) loaded (serial 0)
Nov 20 13:29:34 SaTaN named[692]: Zone "0.0.127.in-addr.arpa" (file named.local): No default TTL set using SOA minimum instead
Nov 20 13:29:34 SaTaN named[692]: master zone "0.0.127.in-addr.arpa" (IN) loaded (serial 1997022700)
Nov 20 13:29:34 SaTaN named[692]: listening on [127.0.0.1].53 (lo)
Nov 20 13:29:34 SaTaN named[692]: listening on [10.0.0.1].53 (eth0)
Nov 20 13:29:34 SaTaN named[692]: Forwarding source address is [0.0.0.0].1025
Nov 20 13:29:34 SaTaN named: named startup succeeded
Nov 20 13:29:34 SaTaN named[693]: Ready to answer queries.
Nov 20 13:29:34 SaTaN named[693]: sysquery: sendto([123.123.123.123].53): Network is unreachable
</PRE>

Si vous voyez une derni&eacute;re ligne comme la mienne, ne vous
inqui&eacute;tez pas. Cela signifie juste que vous n'&ecirc;tes
pas encore connect&eacute; &agrave; Internet. Si vous obtenez des
erreurs, ben, c'est simple, vous n'avez pas &eacute;dit&eacute;
le fichier correctement, et vous devez donc le v&eacute;rifier
(astuce: regardez si tous les ; sont en place et si chaque { est
ferm&eacute; par un } ) 

<H3>2.4 Encore sceptique ?</H3>

Ok, pour tous ceux qui doutent de moi ... 

<PRE>
<I>[root@SaTaN /] nslookup www.iwanttoquerythis.com
Server: localhost
Address: 127.0.0.1

Name: www.iwanttoquerythis.com
Address: 123.123.123.321 ... other ip's ..
Aliases: If available ...</I>
</PRE>

Ceci &eacute;tait la premi&eacute;re requ&ecirc;te, donc elle a
&eacute;tait transmise au serveur DNS du fichier config. C'est
d&eacute;ja une bonne chose que votre serveur DNS transmette les
requ&ecirc;tes :p . 

<PRE>
<I>[root@SaTaN /] nslookup www.iwanttoquerythis.com
Server: localhost
Address: 127.0.0.1

NON-AUTHORITIVE ANSWER
Name: www.iwanttoquerythis.com
Address: 123.123.123.321
Aliases: ...</I>
</PRE>

Deuxi&eacute;me essai, la r&eacute;ponse diff&eacute;re.
Chouette, il nous dit Non-authoritive answer. Qu'est ce que cela
signifie ? Eh bien, il veut dire que cette r&eacute;ponse n'a pas
n&eacute;cessiter de tranmission de la requ&ecirc;te ce qui est
ce nous voulions .<BR>
 

<H3>2.5 Et une autre facon de faire</H3>

Vous pouvez &eacute;galement d&eacute;finir votre propre base de
donn&eacute;es local, &agrave; la main! Il suffit d'ajouter des
lignes au fichier /etc/hosts, qui devront respecter la syntaxe
suivante: <BR>
addresse-IP nom_de_l_hote #commentaire <BR>
Par exemple: <BR>
1.2.3.4 www.some-website.com #un site stupide de plus <BR>
Pour le cas ou vous poseriez la question, le commentaire n'est
pas indispensable :p <BR>
Bien sur, cette m&eacute;thode est moins int&eacute;ressante, car
tout le boulot vous incombe, vous devrez tout rentrer &agrave; la
main :-(   <BR>
 

<H3>2.6 Cache DNS local sous Windows</H3>

Bonjour, malchanceux utilisateurs de Windows. Vous voulez aussi
un joli cache DNS local ? C'est b&ecirc;te, la seule chose que
vous puissiez faire est d'utiliser la m&eacute;thode du chapitre
2.5, en bidouillant dans c:\windows\hosts (ne pas confondre avec
c:\windows\hosts.sam, c'est un exemple de c:\windows\hosts)
&agrave; la place de /etc/hosts. Si tout faire &agrave; la main
vous ennuie, vous pouvez essayer un programme appel&eacute;
FastNet, qui ajoutera au fichier les adresses de vos Favoris,
ainsi que celles de votre Historique, et qui vous permettra en
plus d'entrer &agrave; la main toutes les adresses que vous
voulez. 

<H2>3 La fin</H2>

<H3>3.1 Conclusion</H3>

Apr&eacute;s ce court expos&eacute;, vous devriez &ecirc;tre
capable de mettre en place votre propre serveur de cache DNS.
Bien, j'en ai fini, si vous avez besoin de pr&eacute;cision, vous
pouvez &eacute;crire &agrave; GoMoRRaH. Ce fichier fut
&eacute;crit pour le <A href="http://www.blacksun.box.sk">Black
sun Research Facility</A> 

<P>GoMoRRaH WiLL RiSe aGaiN</P>
</BODY>
</HTML>

<HR align=center width="100%" noShade SIZE=1>
<center>&copy 2001 Blacksun Research Facility. All rights reserved.<br></center>
</body>
</html>